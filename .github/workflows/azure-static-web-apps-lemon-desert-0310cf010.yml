name: Azure Static Web Apps CI/CD

    on:
      push:
        branches:
          - main
      pull_request:
        types: [opened, synchronize, reopened, closed]
        branches:
          - main

    jobs:
      build_and_deploy_job:
        if: github.event_name == 'push' || (github.event_name == 'pull_request' && github.event.action != 'closed')
        runs-on: ubuntu-latest
        name: Build and Deploy Job
        steps:
          - uses: actions/checkout@v3
            with:
              submodules: true
          - name: Build And Deploy
            id: builddeploy
            uses: Azure/static-web-apps-deploy@v1
            with:
              azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_LEMON_DESERT_0310CF010 }} # Make sure this matches the secret name in your GitHub repo
              repo_token: ${{ secrets.GITHUB_TOKEN }}
              action: "upload"
              #
              # === THE DEFINITIVE FIX ===
              # This configuration explicitly tells Azure where your app and API are.
              #
              app_location: "/" 
              api_location: "api"
              output_location: "build"
              app_build_command: "npm install --legacy-peer-deps && npm run build"
              api_build_command: "cd api && npm install" # This ensures the API dependencies are installed

      close_pull_request_job:
        if: github.event_name == 'pull_request' && github.event.action == 'closed'
        runs-on: ubuntu-latest
        name: Close Pull Request Job
        steps:
          - name: Close Pull Request
            id: closepullrequest
            uses: Azure/static-web-apps-deploy@v1
            with:
              azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_LEMON_DESERT_0310CF010 }} # Make sure this matches your secret name
              action: "close"
    ```
    **Important**: Make sure the `azure_static_web_apps_api_token` secret name in the code above exactly matches the one in your GitHub repository's secrets.
